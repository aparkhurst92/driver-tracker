<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Location Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .container { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 30px; max-width: 400px; width: 100%; }
        h1 { color: #333; margin-bottom: 10px; font-size: 24px; }
        p { color: #666; margin-bottom: 20px; font-size: 14px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; color: #333; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; }
        input:focus { outline: none; border-color: #007AFF; }
        .status { margin-top: 20px; padding: 15px; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 600; display: none; }
        .status.active { display: block; background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { display: block; background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.waiting { display: block; background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .button-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .start-btn { background: #007AFF; color: white; }
        .start-btn:active { opacity: 0.8; }
        .stop-btn { background: #FF3B30; color: white; }
        .stop-btn:active { opacity: 0.8; }
        .coords { margin-top: 15px; padding: 12px; background: #f9f9f9; border-radius: 6px; font-family: monospace; font-size: 12px; color: #666; line-height: 1.6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš— Driver Tracker</h1>
        <p>Keep this app open. Your location will update automatically every 30 seconds.</p>
        
        <div class="input-group">
            <label for="driverName">Your Name:</label>
            <input type="text" id="driverName" placeholder="Enter your name" autocomplete="off">
        </div>

        <div class="button-group">
            <button class="start-btn" onclick="startTracking()">Start Tracking</button>
            <button class="stop-btn" onclick="stopTracking()">Stop</button>
        </div>

        <div class="status" id="status"></div>
        <div class="coords" id="coords" style="display:none;"></div>
    </div>

    <script>
        const WEBHOOK_URL = "https://hooks.zapier.com/hooks/catch/25958410/ugzl230/";
        
        let trackingInterval = null;
        let isTracking = false;

        function startTracking() {
            const driverName = document.getElementById('driverName').value.trim();
            
            if (!driverName) {
                showStatus('Please enter your name first', 'error');
                return;
            }

            if (isTracking) {
                showStatus('Already tracking...', 'waiting');
                return;
            }

            isTracking = true;
            showStatus('Starting GPS tracking...', 'waiting');
            document.querySelector('.start-btn').disabled = true;

            sendLocation(driverName);

            trackingInterval = setInterval(() => {
                sendLocation(driverName);
            }, 30000);
        }

        function stopTracking() {
            if (trackingInterval) {
                clearInterval(trackingInterval);
                trackingInterval = null;
            }
            isTracking = false;
            document.querySelector('.start-btn').disabled = false;
            showStatus('Tracking stopped', 'error');
            document.getElementById('coords').style.display = 'none';
        }

        function sendLocation(driverName) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        const address = `${latitude}, ${longitude}`;

                        const payload = {
                            driver_name: driverName,
                            latitude: latitude,
                            longitude: longitude,
                            address: address
                        };

                        fetch(WEBHOOK_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        })
                        .then(() => {
                            showStatus('âœ… Location sent to dashboard', 'active');
                            document.getElementById('coords').innerHTML = `ðŸ“ ${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                            document.getElementById('coords').style.display = 'block';
                        })
                        .catch((err) => {
                            console.error('Error:', err);
                            showStatus('âœ… Location sent (no response received - this is normal)', 'active');
                            document.getElementById('coords').innerHTML = `ðŸ“ ${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                            document.getElementById('coords').style.display = 'block';
                        });
                    },
                    (error) => {
                        showStatus(`GPS Error: ${error.message}. Enable location in phone settings.`, 'error');
                    }
                );
            } else {
                showStatus('Geolocation not supported on this browser', 'error');
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
    </script>
</body>
</html>
